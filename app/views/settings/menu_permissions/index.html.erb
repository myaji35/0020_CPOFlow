<% content_for :title, "메뉴 권한 관리" %>

<div class="flex flex-col gap-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">메뉴 권한 관리</h1>
    <p class="text-sm text-gray-500 mt-1">역할별 메뉴 접근 및 CRUD 권한 설정</p>
  </div>

  <!-- 역할 탭 -->
  <div x-data="{ role: '<%= @role %>' }">
    <div class="flex gap-2 mb-4">
      <% MenuPermission::ROLES.each do |r| %>
        <a href="<%= settings_menu_permissions_path(role: r) %>"
           class="px-4 py-2 text-sm rounded-full font-medium transition-colors
                  <%= @role == r ? 'bg-primary text-white' : 'bg-white border border-gray-200 text-gray-600 hover:border-primary' %>">
          <%= { "viewer" => "Viewer", "member" => "Member", "manager" => "Manager", "admin" => "Admin" }[r] %>
        </a>
      <% end %>
    </div>

    <%= form_with url: settings_update_menu_permissions_path, method: :patch, class: "bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden" do |f| %>
      <%= f.hidden_field :role, value: @role %>

      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-100">
          <tr>
            <th class="text-left px-5 py-3 text-xs font-semibold text-gray-500 uppercase">메뉴</th>
            <th class="text-center px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Read</th>
            <th class="text-center px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Create</th>
            <th class="text-center px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Update</th>
            <th class="text-center px-4 py-3 text-xs font-semibold text-gray-500 uppercase">Delete</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
          <% @permissions.each do |perm| %>
            <tr class="hover:bg-gray-50">
              <td class="px-5 py-3">
                <span class="text-sm font-medium text-gray-900"><%= perm.menu_label %></span>
                <span class="text-xs text-gray-400 ml-2"><%= perm.menu_key %></span>
              </td>
              <% [:can_read, :can_create, :can_update, :can_delete].each do |action| %>
                <td class="text-center px-4 py-3">
                  <% field_name = "permissions[#{perm.menu_key}][#{action}]" %>
                  <input type="checkbox" name="<%= field_name %>" value="1"
                         <%= perm.send(action) ? "checked" : "" %>
                         class="w-4 h-4 rounded border-gray-300 text-primary cursor-pointer">
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>

      <div class="px-5 py-4 bg-gray-50 border-t border-gray-100 flex justify-between items-center">
        <p class="text-xs text-gray-400">
          * Admin 역할은 항상 모든 권한을 가집니다. 위 설정은 admin 외 역할에만 적용됩니다.
        </p>
        <%= f.submit "권한 저장", class: "px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary-dark cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>
